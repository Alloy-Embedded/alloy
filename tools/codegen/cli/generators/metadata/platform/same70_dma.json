{
  "family": "same70",
  "mcu": "atsame70q21b",
  "vendor": "atmel",
  "peripheral_name": "DMA",
  "register_include": "hal/vendors/atmel/same70/registers/xdmac_registers.hpp",
  "bitfield_include": "hal/vendors/atmel/same70/bitfields/xdmac_bitfields.hpp",
  "register_namespace": "alloy::hal::atmel::same70::xdmac",
  "namespace_alias": "xdmac",
  "register_type": "xdmac::XDMAC_Registers",
  "platform_namespace": "alloy::hal::same70",
  "vendor_namespace": "alloy::hal::atmel::same70",
  "requires_clock": false,

  "template_params": [
    {
      "name": "BASE_ADDR",
      "type": "uint32_t",
      "description": "XDMAC peripheral base address"
    },
    {
      "name": "PERIPH_CLOCK_HZ",
      "type": "uint32_t",
      "description": "Peripheral clock frequency"
    }
  ],

  "constants": [
    {
      "name": "NUM_CHANNELS",
      "type": "uint8_t",
      "value": "24",
      "description": "Number of DMA channels"
    }
  ],

  "policy_methods": {
    "description": "Hardware Policy methods for SAME70 XDMAC (DMA)",
    "peripheral_clock_hz": 150000000,
    "mock_hook_prefix": "ALLOY_DMA_MOCK_HW",

    "hw_accessor": {
      "description": "Get pointer to hardware registers",
      "return_type": "volatile RegisterType*",
      "code": "return reinterpret_cast<volatile RegisterType*>(BASE_ADDR);"
    },

    "enable_channel": {
      "description": "Enable DMA channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GE = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_ENABLE"
    },

    "disable_channel": {
      "description": "Disable DMA channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GD = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_DISABLE"
    },

    "suspend_channel": {
      "description": "Suspend DMA channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GRWS = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_SUSPEND"
    },

    "resume_channel": {
      "description": "Resume DMA channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GRWR = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_RESUME"
    },

    "flush_channel": {
      "description": "Flush DMA channel FIFO",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GWS = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_FLUSH"
    },

    "set_source_address": {
      "description": "Set DMA source address",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"},
        {"name": "address", "type": "uint32_t", "description": "Source address"}
      ],
      "return_type": "void",
      "code": "if (channel < 24) { volatile uint32_t* csa = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x50 + (channel * 0x40) + 0x00); *csa = address; }",
      "test_hook": "ALLOY_DMA_TEST_HOOK_SET_SRC"
    },

    "set_destination_address": {
      "description": "Set DMA destination address",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"},
        {"name": "address", "type": "uint32_t", "description": "Destination address"}
      ],
      "return_type": "void",
      "code": "if (channel < 24) { volatile uint32_t* cda = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x50 + (channel * 0x40) + 0x04); *cda = address; }",
      "test_hook": "ALLOY_DMA_TEST_HOOK_SET_DST"
    },

    "set_transfer_size": {
      "description": "Set DMA transfer size",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"},
        {"name": "size", "type": "uint32_t", "description": "Number of transfers"}
      ],
      "return_type": "void",
      "code": "if (channel < 24) { volatile uint32_t* cubc = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x50 + (channel * 0x40) + 0x10); *cubc = size & 0xFFFFFF; }",
      "test_hook": "ALLOY_DMA_TEST_HOOK_SET_SIZE"
    },

    "configure_channel": {
      "description": "Configure DMA channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"},
        {"name": "config", "type": "uint32_t", "description": "Configuration value"}
      ],
      "return_type": "void",
      "code": "if (channel < 24) { volatile uint32_t* cc = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x50 + (channel * 0x40) + 0x08); *cc = config; }",
      "test_hook": "ALLOY_DMA_TEST_HOOK_CONFIG"
    },

    "is_transfer_complete": {
      "description": "Check if DMA transfer is complete",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "bool",
      "const": true,
      "code": "return (hw()->GIS & (1u << channel)) == 0;",
      "test_hook": "ALLOY_DMA_TEST_HOOK_IS_DONE"
    },

    "is_busy": {
      "description": "Check if DMA channel is busy",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "bool",
      "const": true,
      "code": "return (hw()->GS & (1u << channel)) != 0;",
      "test_hook": "ALLOY_DMA_TEST_HOOK_IS_BUSY"
    },

    "enable_interrupt": {
      "description": "Enable DMA channel interrupt",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GIE = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_INT_EN"
    },

    "disable_interrupt": {
      "description": "Disable DMA channel interrupt",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-23)"}
      ],
      "return_type": "void",
      "code": "hw()->GID = (1u << channel);",
      "test_hook": "ALLOY_DMA_TEST_HOOK_INT_DIS"
    }
  },

  "instances": [
    {"name": "Dma", "peripheral_name": "XDMAC", "base": "0x40078000", "clock": "150000000", "description": "XDMAC instance (24 channels)"}
  ],

  "examples": {
    "basic_usage": {
      "description": "Basic DMA usage example",
      "code": "using MyDma = Dma<XDMAC_BASE, 150000000>;\nauto dma = MyDma{};\nuint8_t channel = 0;\ndma.setSourceAddress(channel, src_addr);\ndma.setDestinationAddress(channel, dst_addr);\ndma.setTransferSize(channel, 256);\ndma.enableChannel(channel);\nwhile (!dma.isTransferComplete(channel));"
    }
  }
}
