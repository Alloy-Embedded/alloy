{
  "family": "same70",
  "vendor": "atmel",
  "peripheral_name": "PWM",
  "register_include": "hal/vendors/atmel/same70/registers/pwm0_registers.hpp",
  "bitfield_include": "hal/vendors/atmel/same70/bitfields/pwm0_bitfields.hpp",
  "register_namespace": "alloy::hal::atmel::same70::pwm0",
  "namespace_alias": "pwm",
  "register_type": "pwm0::PWM0_Registers",
  "platform_namespace": "alloy::hal::same70",
  "vendor_namespace": "alloy::hal::atmel::same70",
  "requires_clock": true,

  "template_params": [
    {
      "name": "BASE_ADDR",
      "type": "uint32_t",
      "description": "PWM peripheral base address"
    },
    {
      "name": "PERIPH_CLOCK_HZ",
      "type": "uint32_t",
      "description": "Peripheral clock frequency"
    }
  ],

  "constants": [
    {
      "name": "NUM_CHANNELS",
      "type": "uint8_t",
      "value": "4",
      "description": "Number of PWM channels"
    }
  ],

  "policy_methods": {
    "description": "Hardware Policy methods for SAME70 PWM",
    "peripheral_clock_hz": 150000000,
    "mock_hook_prefix": "ALLOY_PWM_MOCK_HW",

    "hw_accessor": {
      "description": "Get pointer to hardware registers",
      "return_type": "volatile RegisterType*",
      "code": "return reinterpret_cast<volatile RegisterType*>(BASE_ADDR);"
    },

    "enable_channel": {
      "description": "Enable PWM channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"}
      ],
      "return_type": "void",
      "code": "hw()->ENA = (1u << channel);",
      "test_hook": "ALLOY_PWM_TEST_HOOK_ENABLE"
    },

    "disable_channel": {
      "description": "Disable PWM channel",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"}
      ],
      "return_type": "void",
      "code": "hw()->DIS = (1u << channel);",
      "test_hook": "ALLOY_PWM_TEST_HOOK_DISABLE"
    },

    "set_period": {
      "description": "Set PWM period",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"},
        {"name": "period", "type": "uint32_t", "description": "Period value"}
      ],
      "return_type": "void",
      "code": "if (channel < 4) { volatile uint32_t* cprd = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x200 + (channel * 0x20) + 0x0C); *cprd = period; }",
      "test_hook": "ALLOY_PWM_TEST_HOOK_PERIOD"
    },

    "set_duty_cycle": {
      "description": "Set PWM duty cycle",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"},
        {"name": "duty", "type": "uint32_t", "description": "Duty cycle value"}
      ],
      "return_type": "void",
      "code": "if (channel < 4) { volatile uint32_t* cdty = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x200 + (channel * 0x20) + 0x04); *cdty = duty; }",
      "test_hook": "ALLOY_PWM_TEST_HOOK_DUTY"
    },

    "set_prescaler": {
      "description": "Set PWM clock prescaler",
      "parameters": [
        {"name": "prescaler", "type": "uint8_t", "description": "Prescaler value (0-10)"}
      ],
      "return_type": "void",
      "code": "hw()->CLK = (hw()->CLK & ~0x0FF) | (prescaler & 0xFF);",
      "test_hook": "ALLOY_PWM_TEST_HOOK_PRESCALER"
    },

    "set_polarity": {
      "description": "Set PWM output polarity",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"},
        {"name": "inverted", "type": "bool", "description": "true for inverted polarity"}
      ],
      "return_type": "void",
      "code": "if (channel < 4) { volatile uint32_t* cmr = reinterpret_cast<volatile uint32_t*>(BASE_ADDR + 0x200 + (channel * 0x20)); if (inverted) { *cmr |= (1u << 9); } else { *cmr &= ~(1u << 9); } }",
      "test_hook": "ALLOY_PWM_TEST_HOOK_POLARITY"
    },

    "is_channel_enabled": {
      "description": "Check if PWM channel is enabled",
      "parameters": [
        {"name": "channel", "type": "uint8_t", "description": "Channel number (0-3)"}
      ],
      "return_type": "bool",
      "const": true,
      "code": "return (hw()->SR & (1u << channel)) != 0;",
      "test_hook": "ALLOY_PWM_TEST_HOOK_IS_ENABLED"
    }
  },

  "instances": [
    {"name": "Pwm0", "base": "0x40020000", "clock": "150000000", "description": "PWM0 instance"},
    {"name": "Pwm1", "base": "0x4005C000", "clock": "150000000", "description": "PWM1 instance"}
  ]
}
