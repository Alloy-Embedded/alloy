{
  "family": "same70",
  "vendor": "arm",
  "peripheral_name": "SysTick",
  "register_include": "hal/vendors/arm/cortex_m7/systick_registers.hpp",
  "bitfield_include": "hal/vendors/arm/cortex_m7/systick_bitfields.hpp",
  "register_namespace": "alloy::hal::arm::cortex_m7",
  "namespace_alias": "systick",
  "register_type": "cortex_m7::SysTick_Type",
  "platform_namespace": "alloy::hal::same70",
  "vendor_namespace": "alloy::hal::arm::cortex_m7",
  "requires_clock": false,

  "template_params": [
    {
      "name": "BASE_ADDR",
      "type": "uint32_t",
      "description": "SysTick base address (0xE000E010)"
    },
    {
      "name": "CPU_CLOCK_HZ",
      "type": "uint32_t",
      "description": "CPU clock frequency in Hz"
    }
  ],

  "constants": [
    {
      "name": "SYSTICK_BASE",
      "type": "uint32_t",
      "value": "0xE000E010",
      "description": "SysTick base address in ARM Cortex-M"
    }
  ],

  "policy_methods": {
    "description": "Hardware Policy methods for ARM Cortex-M SysTick",
    "peripheral_clock_hz": 300000000,
    "mock_hook_prefix": "ALLOY_SYSTICK_MOCK_HW",

    "hw_accessor": {
      "description": "Get pointer to hardware registers",
      "return_type": "volatile RegisterType*",
      "code": "return reinterpret_cast<volatile RegisterType*>(BASE_ADDR);"
    },

    "enable": {
      "description": "Enable SysTick timer",
      "return_type": "void",
      "code": "hw()->CTRL |= (1u << 0);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_ENABLE"
    },

    "disable": {
      "description": "Disable SysTick timer",
      "return_type": "void",
      "code": "hw()->CTRL &= ~(1u << 0);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_DISABLE"
    },

    "enable_interrupt": {
      "description": "Enable SysTick interrupt",
      "return_type": "void",
      "code": "hw()->CTRL |= (1u << 1);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_INT_EN"
    },

    "disable_interrupt": {
      "description": "Disable SysTick interrupt",
      "return_type": "void",
      "code": "hw()->CTRL &= ~(1u << 1);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_INT_DIS"
    },

    "set_clock_source_cpu": {
      "description": "Set clock source to CPU clock",
      "return_type": "void",
      "code": "hw()->CTRL |= (1u << 2);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_CLK_CPU"
    },

    "set_clock_source_external": {
      "description": "Set clock source to external reference",
      "return_type": "void",
      "code": "hw()->CTRL &= ~(1u << 2);",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_CLK_EXT"
    },

    "set_reload_value": {
      "description": "Set reload value (period)",
      "parameters": [
        {"name": "value", "type": "uint32_t", "description": "Reload value (24-bit, max 0xFFFFFF)"}
      ],
      "return_type": "void",
      "code": "hw()->LOAD = value & 0xFFFFFF;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_RELOAD"
    },

    "get_current_value": {
      "description": "Get current counter value",
      "return_type": "uint32_t",
      "const": true,
      "code": "return hw()->VAL;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_GET_VAL"
    },

    "clear_current_value": {
      "description": "Clear current counter value",
      "return_type": "void",
      "code": "hw()->VAL = 0;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_CLEAR"
    },

    "has_counted_to_zero": {
      "description": "Check if counter has counted to zero (COUNTFLAG)",
      "return_type": "bool",
      "const": true,
      "code": "return (hw()->CTRL & (1u << 16)) != 0;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_FLAG"
    },

    "configure_ms": {
      "description": "Configure SysTick for millisecond interrupts",
      "parameters": [
        {"name": "ms", "type": "uint32_t", "description": "Millisecond period"}
      ],
      "return_type": "void",
      "code": "uint32_t ticks = (CPU_CLOCK_HZ / 1000) * ms; if (ticks > 0xFFFFFF) ticks = 0xFFFFFF; hw()->LOAD = ticks - 1; hw()->VAL = 0; hw()->CTRL = 0x07;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_CONFIG_MS"
    },

    "configure_us": {
      "description": "Configure SysTick for microsecond interrupts",
      "parameters": [
        {"name": "us", "type": "uint32_t", "description": "Microsecond period"}
      ],
      "return_type": "void",
      "code": "uint32_t ticks = (CPU_CLOCK_HZ / 1000000) * us; if (ticks > 0xFFFFFF) ticks = 0xFFFFFF; hw()->LOAD = ticks - 1; hw()->VAL = 0; hw()->CTRL = 0x07;",
      "test_hook": "ALLOY_SYSTICK_TEST_HOOK_CONFIG_US"
    }
  },

  "instances": [
    {"name": "SysTick", "base": "0xE000E010", "clock": "300000000", "description": "ARM Cortex-M7 SysTick timer"}
  ]
}
