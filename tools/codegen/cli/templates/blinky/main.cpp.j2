/**
 * @file main.cpp
 * @brief LED Blinky Example
 *
 * Simple LED blink example for {{ board_name }}.
 * Generated by Alloy CLI.
 */

#include <cstdint>

// Hardware definitions
namespace hw {
    // GPIO base address
    constexpr std::uintptr_t GPIO{{ led_port }}_BASE = {{ gpio_base_addr }};

    // GPIO registers
    struct GPIO {
        volatile std::uint32_t MODER;    // Mode register
        volatile std::uint32_t OTYPER;   // Output type register
        volatile std::uint32_t OSPEEDR;  // Output speed register
        volatile std::uint32_t PUPDR;    // Pull-up/pull-down register
        volatile std::uint32_t IDR;      // Input data register
        volatile std::uint32_t ODR;      // Output data register
        volatile std::uint32_t BSRR;     // Bit set/reset register
        volatile std::uint32_t LCKR;     // Configuration lock register
        volatile std::uint32_t AFR[2];   // Alternate function registers
    };

    // LED pin configuration
    constexpr std::uint32_t LED_PIN = {{ led_pin_number }};
    constexpr std::uint32_t LED_MODER_MASK = (0x3U << (LED_PIN * 2));
    constexpr std::uint32_t LED_MODER_OUTPUT = (0x1U << (LED_PIN * 2));

    // Get GPIO port
    inline GPIO* get_gpio_{{ led_port|lower }}() {
        return reinterpret_cast<GPIO*>(GPIO{{ led_port }}_BASE);
    }
}

/**
 * @brief Simple delay function
 * @param count Delay count (approximate)
 */
void delay(volatile std::uint32_t count) {
    while (count--) {
        __asm__ volatile ("nop");
    }
}

/**
 * @brief Initialize LED GPIO
 */
void led_init() {
    auto gpio = hw::get_gpio_{{ led_port|lower }}();

    // Configure LED pin as output
    gpio->MODER &= ~hw::LED_MODER_MASK;
    gpio->MODER |= hw::LED_MODER_OUTPUT;
}

/**
 * @brief Toggle LED state
 */
void led_toggle() {
    auto gpio = hw::get_gpio_{{ led_port|lower }}();
    gpio->ODR ^= (1U << hw::LED_PIN);
}

/**
 * @brief Main function
 */
int main() {
    // Initialize LED
    led_init();

    // Main loop: Blink LED
    while (true) {
        led_toggle();
        delay({{ delay_cycles }});  // Approximately {{ delay_ms }}ms
    }

    return 0;
}
