# Alloy Framework Metadata - Nucleo-F401RE Board
# Generated by Alloy CLI v2.0.0
# Schema version: 1.0

schema_version: "1.0"

board:
  id: nucleo_f401re
  display_name: Nucleo-F401RE
  vendor: st
  url: https://www.st.com/en/evaluation-tools/nucleo-f401re.html

  description: |
    STMicroelectronics Nucleo-64 development board with STM32F401RE MCU.
    Arduino Uno R3 compatible headers. Integrated ST-LINK/V2-1 debugger.
    Excellent for beginners and rapid prototyping.

mcu:
  part_number: STM32F401RET6
  family: stm32f4

clock:
  system_freq_hz: 84000000    # 84 MHz system clock
  xtal_freq_hz: 8000000       # External 8 MHz crystal (HSE)
  has_pll: true
  # PLL configuration: 8 MHz / 8 * 336 / 4 = 84 MHz

pinout:
  leds:
    - name: LD2
      color: green
      gpio: PA5
      active: high
      description: User LED (also Arduino D13)
      # WARNING: PA5 is shared with SPI1_SCK - using SPI1 will cause LED to flicker

  buttons:
    - name: B1
      gpio: PC13
      active: low
      description: User button (blue)
      # NOTE: Pull-up resistor required (10kΩ recommended)

  debugger:
    type: ST-LINK/V2-1
    uart:
      tx: PA2         # MCU TX → ST-LINK RX
      rx: PA3         # MCU RX → ST-LINK TX
      instance: USART2
      baud_rate: 115200
      description: Virtual COM Port (VCP) for serial debugging
      # IMPORTANT: USART2 on PA2/PA3 is connected to ST-LINK for USB serial

peripherals:
  uart:
    # USART1 - Available on Arduino headers
    - instance: USART1
      pins:
        - tx: PA9       # Arduino D8
          rx: PA10      # Arduino D2
          af: 7
          recommended: true
          note: Standard UART on Arduino headers

        - tx: PB6       # Morpho connector only
          rx: PB7
          af: 7
          note: Alternative pins (Morpho connector)

    # USART2 - Connected to ST-LINK (VCP)
    - instance: USART2
      pins:
        - tx: PA2       # Arduino D1 / ST-LINK TX
          rx: PA3       # Arduino D0 / ST-LINK RX
          af: 7
          recommended: true
          note: Connected to ST-LINK Virtual COM Port
          # CONFLICT: Cannot use PA2/PA3 for other functions

    # USART6 - Available on Morpho connector
    - instance: USART6
      pins:
        - tx: PC6       # Morpho connector
          rx: PC7       # Morpho connector
          af: 8
          note: High-speed UART option (morpho only)

  spi:
    # SPI1 - Arduino headers
    - instance: SPI1
      pins:
        # Default configuration (conflicts with LED!)
        - sck: PA5      # Arduino D13 / LED LD2
          miso: PA6     # Arduino D12
          mosi: PA7     # Arduino D11
          af: 5
          note: SCK shared with LED LD2 - will cause LED flicker during SPI transfers
          # CONFLICT WARNING: Using this pin config will make LED blink during SPI

        # Alternative configuration (recommended - no LED conflict)
        - sck: PB3      # Morpho connector
          miso: PA6     # Arduino D12
          mosi: PA7     # Arduino D11
          af: 5
          recommended: true
          note: Recommended - avoids LED conflict (SCK on PB3 instead of PA5)

  i2c:
    # I2C1 - Arduino headers
    - instance: I2C1
      pins:
        - scl: PB8      # Arduino D15 / I2C_SCL
          sda: PB9      # Arduino D14 / I2C_SDA
          af: 4
          recommended: true
          note: Standard Arduino I2C pins

        - scl: PB6      # Alternative (conflicts with USART1)
          sda: PB7
          af: 4
          note: Alternative pins (conflicts with USART1 alt config)

  adc:
    # ADC1 - Multiple channels available
    - instance: ADC1
      channels:
        - channel: 0
          gpio: PA0
          note: Arduino A0
          recommended: true

        - channel: 1
          gpio: PA1
          note: Arduino A1

        - channel: 4
          gpio: PA4
          note: Arduino A2

        - channel: 5
          gpio: PA5
          note: LED LD2 - not recommended for ADC
          # CONFLICT: Shared with LED

        - channel: 10
          gpio: PC0
          note: Arduino A5

  pwm:
    # TIM2 - 32-bit timer (best for precision)
    - timer: TIM2
      channels:
        - channel: 1
          gpio: PA0
          af: 1
          note: Arduino A0 (conflicts with ADC)

        - channel: 2
          gpio: PA1
          af: 1
          note: Arduino A1 (conflicts with ADC)

    # TIM3 - General-purpose timer
    - timer: TIM3
      channels:
        - channel: 1
          gpio: PB4
          af: 2
          note: Arduino D5 (PWM-capable)

        - channel: 2
          gpio: PB5
          af: 2
          note: Arduino D4 (PWM-capable)

  usb:
    - instance: USB_OTG_FS
      pins:
        dm: PA11        # USB D-
        dp: PA12        # USB D+
      note: Full-Speed USB (12 Mbps) - requires external connector (not populated)
      # WARNING: USB pins not easily accessible on Nucleo-64 (would need soldering)

connectors:
  arduino_uno_r3:
    description: Arduino Uno R3 compatible headers
    compatible: true
    shields_supported: true
    notes:
      - "Most Arduino shields work directly"
      - "3.3V logic levels (not 5V tolerant on all pins)"
      - "Some pins have conflicts (e.g., PA5 LED)"

  morpho:
    description: ST Morpho extension connector
    pins: 70
    notes:
      - "Access to all MCU pins"
      - "Additional peripherals not on Arduino headers"

examples:
  - blink              # Classic LED blink example
  - uart_echo          # Echo characters over USART2 (VCP)
  - systick_demo       # SysTick timer demonstration
  - adc_read           # Read analog input from A0
  - pwm_led            # PWM-controlled LED brightness

status: supported

tags:
  - beginner-friendly
  - arduino-compatible
  - nucleo
  - st-link
  - usb-vcp
