# Alloy Framework Metadata - STM32F4 Family
# Generated by Alloy CLI v2.0.0
# Schema version: 1.0

schema_version: "1.0"

family:
  id: stm32f4
  vendor: st
  display_name: STM32F4 Series

  # High-performance ARM Cortex-M4 MCUs with FPU and DSP instructions
  # Target applications: Motor control, digital audio, sensor fusion, IoT gateways
  # Notable features: Hardware FPU for efficient floating-point math, DSP extensions
  description: |
    The STM32F4 series offers a balance of performance and power efficiency,
    featuring a Cortex-M4F core with FPU and DSP instructions. Perfect for
    motor control, digital audio processing, and sensor fusion applications.

    Key advantages:
    - Up to 180 MHz operation (F4x9 family)
    - Single-precision FPU for fast floating-point operations
    - DSP instructions for signal processing
    - Rich peripheral set (USB OTG, Ethernet, CAN, etc.)

  core: Cortex-M4F
  features:
    - FPU              # Hardware floating-point unit (IEEE 754 single-precision)
    - DSP Instructions # Digital signal processing extensions
    - MPU              # Memory Protection Unit (optional)

mcus:
  # STM32F401RE - Popular on Nucleo-F401RE board
  - part_number: STM32F401RET6
    display_name: STM32F401RE
    core: Cortex-M4F
    max_freq_mhz: 84

    memory:
      flash_kb: 512
      sram_kb: 96
      eeprom_kb: 0     # STM32 doesn't have EEPROM, use FLASH emulation

    package:
      type: LQFP64
      pins: 64
      io_pins: 50

    peripherals:
      uart:
        count: 3
        instances: [USART1, USART2, USART6]
        # IMPORTANT: USART1/USART6 support higher baud rates (5.25 Mbps max)
        # USART2 is limited to 2.625 Mbps (APB1 clock limitation)
        max_baud_rate:
          USART1: 5250000
          USART2: 2625000
          USART6: 5250000

      spi:
        count: 4
        instances: [SPI1, SPI2, SPI3, SPI4]
        max_speed_mbps: 42  # Up to 42 MHz SPI clock (APB2 / 2)
        # NOTE: SPI1 and SPI4 on APB2 (faster), SPI2/SPI3 on APB1

      i2c:
        count: 3
        instances: [I2C1, I2C2, I2C3]
        max_speed_khz: 1000  # Fast-mode Plus (Fm+)
        # QUIRK: I2C requires specific timing configuration for reliability

      adc:
        count: 1
        resolution_bits: 12
        channels: 16
        max_sample_rate_ksps: 2400  # 2.4 MSPS total
        # NOTE: All channels share one ADC, multiplex for multi-channel

      timers:
        count: 11
        types:
          - "2x 32-bit advanced timers (TIM2, TIM5)"
          - "8x 16-bit general-purpose timers"
          - "1x 16-bit basic timer"
        # PERFORMANCE: 32-bit timers are better for precision timing

      usb:
        count: 1
        type: OTG Full-Speed
        max_speed_mbps: 12
        # NOTE: Requires external PHY for High-Speed

      gpio:
        ports: [GPIOA, GPIOB, GPIOC, GPIOD, GPIOE, GPIOH]
        pins_per_port: 16
        # QUIRK: GPIOH has fewer pins (PH0-PH1 only on F401)

    documentation:
      datasheet: https://www.st.com/resource/en/datasheet/stm32f401re.pdf
      reference_manual: https://www.st.com/resource/en/reference_manual/dm00096844.pdf
      errata: https://www.st.com/resource/en/errata_sheet/dm00105230.pdf
      programming_manual: https://www.st.com/resource/en/programming_manual/pm0214.pdf
      svd_file: tools/codegen/svd/upstream/STMicro/STM32F401.svd

    boards:
      - nucleo_f401re

    status: production
    tags:
      - beginner-friendly
      - arduino-compatible
      - low-power
      - usb

  # STM32F407VG - High-performance variant with more peripherals
  - part_number: STM32F407VGT6
    display_name: STM32F407VG
    core: Cortex-M4F
    max_freq_mhz: 168  # Higher clock than F401

    memory:
      flash_kb: 1024   # Twice the flash
      sram_kb: 192     # Twice the SRAM (128 KB + 64 KB CCM)
      eeprom_kb: 0

    package:
      type: LQFP100
      pins: 100
      io_pins: 82

    peripherals:
      uart:
        count: 6       # More UARTs than F401
        instances: [USART1, USART2, USART3, UART4, UART5, USART6]

      spi:
        count: 3
        max_speed_mbps: 42

      i2c:
        count: 3
        max_speed_khz: 400  # F407 doesn't have Fm+ on all I2C

      adc:
        count: 3           # Triple ADC for simultaneous sampling
        resolution_bits: 12
        channels: 16
        max_sample_rate_ksps: 7200  # 2.4 MSPS per ADC * 3
        # PERFORMANCE: Triple ADC mode enables 7.2 MSPS total

      timers:
        count: 14
        types:
          - "2x 32-bit advanced timers"
          - "10x 16-bit general-purpose timers"
          - "2x 16-bit basic timers"

      usb:
        count: 2
        types:
          - "USB OTG FS (Full-Speed)"
          - "USB OTG HS (High-Speed with external PHY)"

      ethernet:
        count: 1
        type: 10/100 Mbps MAC
        # NOTE: Requires external PHY (e.g., LAN8742A)

      can:
        count: 2
        instances: [CAN1, CAN2]
        # QUIRK: CAN2 cannot operate without CAN1 enabled (shared filters)

      sdio:
        count: 1
        max_speed_mhz: 48
        # NOTE: 4-bit wide bus support for SD cards

      gpio:
        ports: [GPIOA, GPIOB, GPIOC, GPIOD, GPIOE, GPIOF, GPIOG, GPIOH, GPIOI]
        pins_per_port: 16

    documentation:
      datasheet: https://www.st.com/resource/en/datasheet/stm32f407vg.pdf
      reference_manual: https://www.st.com/resource/en/reference_manual/dm00031020.pdf
      errata: https://www.st.com/resource/en/errata_sheet/dm00037591.pdf
      svd_file: tools/codegen/svd/upstream/STMicro/STM32F407.svd

    boards:
      - stm32f4_discovery

    status: production
    tags:
      - high-performance
      - ethernet
      - usb-hs
      - motor-control
