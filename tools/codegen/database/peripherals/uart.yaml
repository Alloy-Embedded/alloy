# Alloy Framework Metadata - UART Peripheral
# Generated by Alloy CLI v2.0.0
# Schema version: 1.0

schema_version: "1.0"

peripheral:
  id: uart
  display_name: UART/USART
  type: communication

  description: |
    Universal Asynchronous Receiver/Transmitter (UART) peripheral.
    Provides serial communication capabilities with configurable baud rates,
    parity, stop bits, and hardware flow control.

implementations:
  # STM32F4 family
  - family: stm32f4
    status: implemented
    api_levels:
      - simple     # Basic blocking API
      - fluent     # Fluent builder pattern
      - expert     # Direct register access

    features:
      - Blocking transmit/receive
      - Interrupt-driven I/O
      - DMA support
      - Hardware flow control (RTS/CTS)
      - Configurable baud rate (up to 10.5 Mbps)
      - Parity check (even/odd/none)
      - Multi-drop mode
      - LIN mode support

    limitations:
      - DMA not implemented yet in Simple API
      - LIN mode not exposed in current API
      - Multi-processor mode not implemented
      # PLANNED: DMA support coming in v2.1

    template: tools/codegen/templates/platform/uart.jinja2
    # NOTE: Template owned by library-quality-improvements spec

    tests:
      unit_tests: true
      hardware_tests: true
      coverage_percent: 85

    quirks:
      - description: "USART1/6 on APB2 (faster), USART2/3 on APB1"
        impact: "Different maximum baud rates"
        workaround: "Check datasheet for max baud rate per USART"

      - description: "Overrun error common at high baud rates without proper buffering"
        impact: "Data loss if RX buffer overflows"
        workaround: "Use interrupt or DMA mode for high-speed communication"

  # SAME70 family
  - family: same70
    status: implemented
    api_levels:
      - simple
      - fluent

    features:
      - Blocking transmit/receive
      - Interrupt-driven I/O
      - Configurable baud rate
      - Parity check
      - Hardware flow control

    limitations:
      - DMA support limited
      - Expert API not yet implemented
      # PLANNED: Expert API in v2.2

    template: tools/codegen/templates/platform/uart.jinja2

    tests:
      unit_tests: true
      hardware_tests: true
      coverage_percent: 75

    quirks:
      - description: "UART peripheral has different register layout than STM32"
        impact: "Cannot share register-level code"
        workaround: "Use abstraction layer (Simple/Fluent API)"

  # STM32G0 family
  - family: stm32g0
    status: in_progress
    api_levels:
      - simple     # Available
      # TODO: Add fluent and expert

    features:
      - Blocking transmit/receive
      - Basic interrupt support

    limitations:
      - Only Simple API currently available
      - No DMA support yet
      - Hardware flow control not implemented

    tests:
      unit_tests: true
      hardware_tests: false  # No hardware available yet
      coverage_percent: 60

documentation:
  api_reference: https://alloy-docs.example.com/api/uart
  examples:
    - examples/uart/echo.cpp
    - examples/uart/interrupt_rx.cpp
    - examples/uart/dma_transfer.cpp
  tutorials:
    - docs/tutorials/uart_getting_started.md
    - docs/tutorials/uart_advanced.md

usage_examples:
  simple_api: |
    // Simple API - Blocking operations
    Uart uart(USART2, 115200);
    uart.configure();

    uart.send("Hello\n");

    char buffer[64];
    size_t received = uart.receive(buffer, sizeof(buffer));

  fluent_api: |
    // Fluent API - Builder pattern
    auto uart = Uart::create()
        .with_peripheral(USART2)
        .with_baud_rate(115200)
        .with_parity(Parity::None)
        .with_stop_bits(StopBits::One)
        .with_flow_control(FlowControl::None)
        .build();

    uart.send("Hello\n");

  expert_api: |
    // Expert API - Direct register access
    auto uart = UartExpert<USART2_BASE>::create()
        .set_baud_rate(115200)
        .enable_tx()
        .enable_rx();

    uart.write_data_register(0x41);  // Send 'A'

performance:
  typical_baud_rates:
    - 9600
    - 115200
    - 921600
    - 2000000     # 2 Mbps (high-speed)

  max_baud_rate_by_family:
    stm32f4:
      USART1: 5250000   # APB2 (84 MHz / 16)
      USART2: 2625000   # APB1 (42 MHz / 16)
      USART6: 5250000   # APB2

    same70:
      UART0: 6000000    # Peripheral clock dependent
      UART1: 6000000

  cpu_overhead:
    blocking_mode: "High (CPU waits for each byte)"
    interrupt_mode: "Low (CPU handles ISR only)"
    dma_mode: "Minimal (CPU configures, DMA transfers)"
