# Alloy Framework Project Template - Blinky
# Generated by Alloy CLI v2.0.0
# Schema version: 1.0
# Owner: enhance-cli-professional-tool (CLI Spec)

schema_version: "1.0"

template:
  id: blinky
  display_name: "LED Blink"
  type: project   # Project template (owned by CLI spec)
  difficulty: beginner
  estimated_time_minutes: 5

  description: |
    Classic "Hello World" for embedded systems - blinks an LED.
    Perfect for beginners to verify toolchain and board setup.

    What you'll learn:
    - GPIO configuration
    - Simple delay loops
    - Basic project structure

requirements:
  board_features:
    - led             # Must have at least one LED

  peripherals:
    required:
      - gpio
    optional: []

  build_system:
    - cmake
    - meson

files:
  # Main application file
  - path: src/main.cpp
    template: |
      #include "alloy/core/target.hpp"
      #include "alloy/hal/gpio.hpp"
      #include "alloy/hal/systick.hpp"

      using namespace alloy;

      int main() {
          // Configure LED pin ({{ board.led.gpio }})
          auto led = Gpio::create()
              .with_pin({{ board.led.gpio }})
              .as_output()
              .build();

          // Configure SysTick for 1ms interrupts
          SysTick::configure({{ board.clock.system_freq_hz }} / 1000);

          // Blink loop
          while (true) {
              led.toggle();
              SysTick::delay_ms(500);  // 500ms delay (1 Hz blink)
          }

          return 0;
      }

  # CMake configuration
  - path: CMakeLists.txt
    template: |
      cmake_minimum_required(VERSION 3.20)

      # Project name
      project({{ project.name }} LANGUAGES C CXX ASM)

      # Set C++ standard
      set(CMAKE_CXX_STANDARD 23)
      set(CMAKE_CXX_STANDARD_REQUIRED ON)

      # Alloy framework path
      set(ALLOY_ROOT ${CMAKE_SOURCE_DIR}/../..)

      # Board configuration
      set(ALLOY_BOARD {{ board.id }})
      set(ALLOY_MCU {{ board.mcu.part_number }})

      # Include Alloy
      add_subdirectory(${ALLOY_ROOT} alloy)

      # Executable
      add_executable({{ project.name }}
          src/main.cpp
      )

      target_link_libraries({{ project.name }}
          alloy::core
          alloy::hal
      )

      # Flash target
      add_custom_target(flash
          COMMAND openocd -f board/{{ board.openocd_config }}.cfg
                  -c "program ${CMAKE_BINARY_DIR}/{{ project.name }}.elf verify reset exit"
          DEPENDS {{ project.name }}
          COMMENT "Flashing {{ project.name }} to board..."
      )

  # README
  - path: README.md
    template: |
      # {{ project.name }}

      Simple LED blink example for {{ board.display_name }}.

      ## Hardware Setup

      - Board: {{ board.display_name }}
      - LED: {{ board.led.name }} ({{ board.led.color }}) on {{ board.led.gpio }}

      ## Build Instructions

      ```bash
      mkdir build && cd build
      cmake ..
      make
      ```

      ## Flash to Board

      ```bash
      make flash
      ```

      Or using Alloy CLI:

      ```bash
      alloy build compile
      alloy build flash
      ```

      ## Expected Behavior

      The {{ board.led.color }} LED ({{ board.led.name }}) should blink at 1 Hz (500ms on, 500ms off).

      ## Troubleshooting

      - **LED doesn't blink**: Check that ST-LINK is connected and board is powered
      - **Build errors**: Verify toolchain is installed (`arm-none-eabi-gcc --version`)
      - **Flash errors**: Try `openocd -f board/{{ board.openocd_config }}.cfg` to test connection

  # .gitignore
  - path: .gitignore
    template: |
      # Build artifacts
      build/
      *.elf
      *.bin
      *.hex
      *.map

      # IDE files
      .vscode/
      .idea/
      *.code-workspace

      # OS files
      .DS_Store
      Thumbs.db

variables:
  project:
    name:
      type: string
      prompt: "Project name"
      default: "blinky"
      pattern: "^[a-z][a-z0-9_]*$"

  board:
    # Automatically filled from board database
    id: null
    display_name: null
    led:
      name: null
      gpio: null
      color: null
    clock:
      system_freq_hz: null
    mcu:
      part_number: null
    openocd_config: null

wizard_steps:
  - step: 1
    title: "Select Board"
    description: "Choose your development board"
    action: select_board
    filter:
      has_led: true  # Must have LED for blink example

  - step: 2
    title: "Project Configuration"
    description: "Configure project settings"
    prompts:
      - variable: project.name
        type: text
        default: "blinky"

  - step: 3
    title: "Build System"
    description: "Choose build system"
    prompts:
      - variable: build_system
        type: choice
        options: [cmake, meson]
        default: cmake

  - step: 4
    title: "Review"
    description: "Review configuration before generating"
    action: show_summary

post_generation:
  - action: configure_build
    description: "Run CMake configuration"

  - action: show_next_steps
    message: |
      âœ… Project created successfully!

      Next steps:
        1. cd {{ project.name }}
        2. mkdir build && cd build
        3. cmake ..
        4. make
        5. make flash

      Or using Alloy CLI:
        1. cd {{ project.name }}
        2. alloy build configure
        3. alloy build compile
        4. alloy build flash

      Happy coding! ðŸš€

tags:
  - beginner
  - gpio
  - led
  - hello-world
